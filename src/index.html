<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTNDraw - simple draw tool for everyone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            height: 100%;
            width: 100%;
        }

        svg {
            /* Keyword: Inline element white space margin */
            vertical-align: top;
            background-color: black;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>

<body>
    <svg></svg>
</body>

<script>
    var svg = document.getElementsByTagName("svg")[0];
    var drawing = false;
    var currentCursorPosition = { x: 0, y: 0 };
    var oldCursorPosition = { x: 0, y: 0 };

    // Listen touch events of finger on mobile
    svg.addEventListener("touchstart", function (e) {
        drawing = true;
        setCurrentCursorPosition(e);
        var circle = createCircle();
        svg.appendChild(circle);
    });

    svg.addEventListener("touchmove", function (e) {
        if (drawing === true) {
            setOldCursorPosition();
            setCurrentCursorPosition(e);
            var line = createLine();
            svg.appendChild(line);
        }
    });

    svg.addEventListener("touchend", function (e) {
        drawing = false;
    });

    // Listen move events of mouse on desktop
    svg.addEventListener("mousedown", function (e) {
        drawing = true;
        setCurrentCursorPosition(e);
        var circle = createCircle();
        svg.appendChild(circle);
    });

    svg.addEventListener("mousemove", function (e) {
        if (drawing === true) {
            setOldCursorPosition();
            setCurrentCursorPosition(e);
            var line = createLine();
            svg.appendChild(line);
        }
    });

    svg.addEventListener("mouseup", function (e) {
        drawing = false;
    });

    function createCircle() {
        var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute("fill", "#FFFFFF");
        circle.setAttribute("r", 1);
        circle.setAttribute("cx", currentCursorPosition.x);
        circle.setAttribute("cy", currentCursorPosition.y);
        return circle;
    }

    function createLine() {
        var line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute("stroke", "#FFFFFF");
        line.setAttribute("stroke-width", 2);
        line.setAttribute("x1", oldCursorPosition.x);
        line.setAttribute("y1", oldCursorPosition.y);
        line.setAttribute("x2", currentCursorPosition.x);
        line.setAttribute("y2", currentCursorPosition.y);
        return line;
    }

    function setCurrentCursorPosition(e) {
        if (e.touches !== undefined) {
            currentCursorPosition.x = e.touches[0].clientX;
            currentCursorPosition.y = e.touches[0].clientY;
            return;
        }

        currentCursorPosition.x = e.clientX;
        currentCursorPosition.y = e.clientY;
    }

    function setOldCursorPosition() {
        oldCursorPosition.x = currentCursorPosition.x;
        oldCursorPosition.y = currentCursorPosition.y;
    }

    // handle shortcut
    document.addEventListener("keydown", function (e) {
        if (e.altKey === true) {
            switch (e.key) {
                case "c": {
                    // erase everything
                    while (svg.lastChild) {
                        svg.removeChild(svg.lastChild);
                    }
                    break;
                }
                case "g": {
                    var xmlSerializer = new XMLSerializer();
                    var svgXMLstr = xmlSerializer.serializeToString(svg);
                    var canvas = document.createElement("canvas");
                    var rect = svg.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = rect.height;
                    var ctx = canvas.getContext("2d");
                    ctx.rect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    var image = new Image();
                    image.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svgXMLstr);
                    image.onload = function () {
                        ctx.drawImage(image, 0, 0);
                        var dataURL = canvas.toDataURL("image/png").replace("image/png", "octet-stream");
                        var a = document.createElement("a");
                        a.setAttribute("download", "dtndraw.png");
                        a.setAttribute("href", dataURL);
                        a.click();
                    }
                }
            }
        }
    });

</script>

</html>